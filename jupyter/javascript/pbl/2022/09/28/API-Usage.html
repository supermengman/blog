<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Rapid API Implementation</h1><p class="page-description">Finding an api on rapidAPI and practicing requests</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-09-28T00:00:00-05:00" itemprop="datePublished">
        Sep 28, 2022
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/blog/categories/#jupyter">jupyter</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#javascript">javascript</a>
        &nbsp;
      
        <a class="category-tags-link" href="/blog/categories/#pbl">pbl</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-justify-center">
          <div class="px-2">

    <a href="https://github.com/supermengman/blog/tree/master/_notebooks/2022-09-28-API-Usage.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/blog/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/supermengman/blog/master?filepath=_notebooks%2F2022-09-28-API-Usage.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/supermengman/blog/blob/master/_notebooks/2022-09-28-API-Usage.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/blog/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
          <div class="px-2">
  <a href="https://deepnote.com/launch?url=https%3A%2F%2Fgithub.com%2Fsupermengman%2Fblog%2Fblob%2Fmaster%2F_notebooks%2F2022-09-28-API-Usage.ipynb" target="_blank">
      <img class="notebook-badge-image" src="/blog/assets/badges/deepnote.svg" alt="Launch in Deepnote"/>
  </a>
</div>

        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#Backend-implementation-on-Spring-boot:">Backend implementation on Spring boot: </a></li>
<li class="toc-entry toc-h2"><a href="#Questions?">Questions? </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2022-09-28-API-Usage.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Find an API and implement Fetch following Covid example. Answer these questions in implementation…</p>
<p>Benefit of using and API?
Benefit(s) of backend implementation?</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To Do:</p>
<ul>
<li>[x] find API on rapidAPI</li>
<li>[x] copy/repackage code from project link</li>
<li>[x] make sure that httprequest itself works</li>
<li>[x] parse json to find stuff</li>
<li>[ ] possibly build spring boot around it (using objects); </li>
<li>[ ] restart instance, test on ec2 --&gt; deploy</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-java"><pre><span></span><span class="kn">import</span> <span class="nn">java.net.URI</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.net.http.HttpClient</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.net.http.HttpRequest</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.net.http.HttpResponse</span><span class="p">;</span>

<span class="c1">//RapidAPI header  https://rapidapi.com/spamakashrajtech/api/corona-virus-world-and-india-data</span>
<span class="n">HttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">HttpRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
    <span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="n">URI</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="s">"https://weatherapi-com.p.rapidapi.com/current.json?q=209.66.205.197"</span><span class="p">))</span>
    <span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="s">"X-RapidAPI-Key"</span><span class="p">,</span> <span class="s">"0fb4bb4059msh8489d467f79e14ep1d57f9jsnd0d67fb163e6"</span><span class="p">)</span>
    <span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="s">"X-RapidAPI-Host"</span><span class="p">,</span> <span class="s">"weatherapi-com.p.rapidapi.com"</span><span class="p">)</span>
    <span class="p">.</span><span class="na">method</span><span class="p">(</span><span class="s">"GET"</span><span class="p">,</span> <span class="n">HttpRequest</span><span class="p">.</span><span class="na">BodyPublishers</span><span class="p">.</span><span class="na">noBody</span><span class="p">())</span>
    <span class="p">.</span><span class="na">build</span><span class="p">();</span>

<span class="c1">//RapidAPI request and response</span>
<span class="n">HttpResponse</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">HttpClient</span><span class="p">.</span><span class="na">newHttpClient</span><span class="p">().</span><span class="na">send</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="p">.</span><span class="na">BodyHandlers</span><span class="p">.</span><span class="na">ofString</span><span class="p">());</span>

<span class="c1">//RapidAPI Body</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">body</span><span class="p">());</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{"location":{"name":"Rancho Penasquitos","region":"California","country":"United States of America","lat":32.96,"lon":-117.11,"tz_id":"America/Los_Angeles","localtime_epoch":1664390698,"localtime":"2022-09-28 11:44"},"current":{"last_updated_epoch":1664389800,"last_updated":"2022-09-28 11:30","temp_c":28.3,"temp_f":82.9,"is_day":1,"condition":{"text":"Sunny","icon":"//cdn.weatherapi.com/weather/64x64/day/113.png","code":1000},"wind_mph":2.2,"wind_kph":3.6,"wind_degree":239,"wind_dir":"WSW","pressure_mb":1014.0,"pressure_in":29.95,"precip_mm":0.0,"precip_in":0.0,"humidity":55,"cloud":0,"feelslike_c":29.6,"feelslike_f":85.3,"vis_km":16.0,"vis_miles":9.0,"uv":7.0,"gust_mph":4.3,"gust_kph":6.8}}
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Backend-implementation-on-Spring-boot:">
<a class="anchor" href="#Backend-implementation-on-Spring-boot:" aria-hidden="true"><span class="octicon octicon-link"></span></a>Backend implementation on Spring boot:<a class="anchor-link" href="#Backend-implementation-on-Spring-boot:"> </a>
</h2>
<p><img src="/blog/images/copied_from_nb/./images/backendAPI.png" alt="backend API"></p>
<p>As seen, I set up the code such that I could get (curl) a site on my local spring boot, returning the data about weather. I was about to implement this into displaying with javascript, but as of now the AWS servers are down so the links are not working yet. If it does get fixed, it will be seen <a href="https://supermengman.github.io/blog/data/weather">here</a>.</p>
<p>The source code can be seen <a href="https://github.com/supermengman/using-objects/blob/main/src/main/java/com/nighthawk/spring_portfolio/hacks/api/WeatherApiController.java">here</a>, but here is a snippet of the code that i changed:</p>
<div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">ResponseEntity</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;</span> <span class="nf">getCovid</span><span class="p">()</span> <span class="p">{</span>

        <span class="c1">//calls API once a day, sets body and status properties</span>
        <span class="n">Long</span> <span class="n">currentTime</span> <span class="o">=</span> <span class="n">System</span><span class="p">.</span><span class="na">currentTimeMillis</span><span class="p">()</span><span class="o">/</span><span class="p">(</span><span class="mi">1000</span><span class="o">*</span><span class="mi">60</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">last_run</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="p">(</span><span class="n">currentTime</span> <span class="o">-</span> <span class="n">last_run</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>  <span class="c1">//APIs can fail (ie Internet or Service down)</span>

                <span class="c1">//RapidAPI header</span>
                <span class="n">HttpRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">HttpRequest</span><span class="p">.</span><span class="na">newBuilder</span><span class="p">()</span>
                    <span class="p">.</span><span class="na">uri</span><span class="p">(</span><span class="n">URI</span><span class="p">.</span><span class="na">create</span><span class="p">(</span><span class="s">"https://weatherapi-com.p.rapidapi.com/current.json?q=209.66.205.197"</span><span class="p">))</span>
                    <span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="s">"X-RapidAPI-Key"</span><span class="p">,</span> <span class="s">"0fb4bb4059msh8489d467f79e14ep1d57f9jsnd0d67fb163e6"</span><span class="p">)</span>
                    <span class="p">.</span><span class="na">header</span><span class="p">(</span><span class="s">"X-RapidAPI-Host"</span><span class="p">,</span> <span class="s">"weatherapi-com.p.rapidapi.com"</span><span class="p">)</span>
                    <span class="p">.</span><span class="na">method</span><span class="p">(</span><span class="s">"GET"</span><span class="p">,</span> <span class="n">HttpRequest</span><span class="p">.</span><span class="na">BodyPublishers</span><span class="p">.</span><span class="na">noBody</span><span class="p">())</span>
                    <span class="p">.</span><span class="na">build</span><span class="p">();</span>


                <span class="c1">//RapidAPI request and response</span>
                <span class="n">HttpResponse</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">HttpClient</span><span class="p">.</span><span class="na">newHttpClient</span><span class="p">().</span><span class="na">send</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">HttpResponse</span><span class="p">.</span><span class="na">BodyHandlers</span><span class="p">.</span><span class="na">ofString</span><span class="p">());</span>

                <span class="c1">//JSONParser extracts text body and parses to JSONObject</span>
                <span class="k">this</span><span class="p">.</span><span class="na">body</span> <span class="o">=</span> <span class="p">(</span><span class="n">JSONObject</span><span class="p">)</span> <span class="k">new</span> <span class="n">JSONParser</span><span class="p">().</span><span class="na">parse</span><span class="p">(</span><span class="n">response</span><span class="p">.</span><span class="na">body</span><span class="p">());</span>
                <span class="k">this</span><span class="p">.</span><span class="na">status</span> <span class="o">=</span> <span class="n">HttpStatus</span><span class="p">.</span><span class="na">OK</span><span class="p">;</span>  <span class="c1">//200 success</span>
                <span class="k">this</span><span class="p">.</span><span class="na">last_run</span> <span class="o">=</span> <span class="n">currentTime</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">catch</span> <span class="p">(</span><span class="n">Exception</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">//capture failure info</span>
                <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&gt;</span> <span class="n">status</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;&gt;</span><span class="p">();</span>
                <span class="n">status</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="s">"status"</span><span class="p">,</span> <span class="s">"RapidApi failure: "</span> <span class="o">+</span> <span class="n">e</span><span class="p">);</span>

                <span class="c1">//Setup object for error</span>
                <span class="k">this</span><span class="p">.</span><span class="na">body</span> <span class="o">=</span> <span class="p">(</span><span class="n">JSONObject</span><span class="p">)</span> <span class="n">status</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="na">status</span> <span class="o">=</span> <span class="n">HttpStatus</span><span class="p">.</span><span class="na">INTERNAL_SERVER_ERROR</span><span class="p">;</span> <span class="c1">//500 error</span>
                <span class="k">this</span><span class="p">.</span><span class="na">last_run</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
</pre></div>
<p>Instead of getting the date, I get the epoch time and convert it to minutes. When I pull from the API, if it is successfull, I set the time that I ran the API to the last_run. So, if the difference between the two runs is greater than 5 minutes, then it will request the API again. As this is weather, I think 5 minutes is adequate time, and also enough to take advantage of my 1 million requests per month.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Questions?">
<a class="anchor" href="#Questions?" aria-hidden="true"><span class="octicon octicon-link"></span></a>Questions?<a class="anchor-link" href="#Questions?"> </a>
</h2>
<ol>
<li>Benefit of using an API?</li>
</ol>
<p>An API allows code to interact with data from a server, and this is necessary especailly for our development environment, which is deploying a website. We will constantly have to interact with web servers and possibly serve our own data, so an API is necessary to make it easy to access data without having to write a lot of code. It provides a template for easier interaction in the future.</p>
<ol>
<li>Benefits of backend implementation?</li>
</ol>
<p>As described above, if it was only frontend, the code would have to request the source api every time a user reloads, which could be wasteful if the API hasn't had any meaningful changes or updates to its data. So, mine limits requests to every 5 minutes to the source server, caching and saving the last run. This cuts down on unnecessary cost, which could be a problem when scaled up.</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="supermengman/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/blog/jupyter/javascript/pbl/2022/09/28/API-Usage.html" hidden></a>
</article>
